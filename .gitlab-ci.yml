image: ubuntu:18.04

stages:
  deploy

before_script:
  - apt-get update -qy
  - apt-get install -y lftp

# only:
#     - master
#     deploy:
#     state: deploy
#     script:
#         - lftp -e "open $FTP_HOST; user $FTP_USERNAME $c; mirror -X .* -X .*/ --reverse --verbose --delete local-folder/ destination-folder/; bye"

compile_assets:
  stage: build
  script:
    - yarn install --pure-lockfile --cache-folder .yarn-cache
    - yarn build

deploy:
    stage: deploy
    only:
        - master
        deploy:
    script:
    - apt-get update -qq && apt-get install -y -qq lftp
    - lftp -c "set ftp:ssl-allow no; open -u $FTP_PASSWORD, $FTP_PASSWORD $FTP_HOST; mirror -Rev public/ ./_sub/blog  --ignore-time --parallel=10 --exclude-glob .git* --exclude .git/"
